<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <t        </div>
    </div>

    <div class="interaction-hint">
        üñ±Ô∏è Drag to rotate ‚Ä¢ üå∏ Interactive 3D Pookalam
    </div>

    <script src="https://cdnjs.cloudflare.com/ajax/libs/three.js/r128/three.min.js"></script>e-a-Pookalam | Digital Floral Carpet for Onam</title>
    <style>
        * { margin: 0; padding: 0; box-sizing: border-box; }
        body { 
            font-family: 'Segoe UI', Arial, sans-serif; 
            background: linear-gradient(45deg, #1a1a2e, #16213e, #0f3460);
            color: white; 
            overflow: hidden;
        }
        canvas { 
            display: block; 
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            cursor: grab;
        }
        canvas:active { cursor: grabbing; }
        .controls {
            position: fixed;
            top: 20px;
            right: 20px;
            background: rgba(0,0,0,0.9);
            padding: 1rem;
            border-radius: 10px;
            backdrop-filter: blur(10px);
            border: 1px solid rgba(255, 107, 53, 0.3);
            min-width: 250px;
            z-index: 100;
            max-height: 70vh;
            overflow-y: auto;
        }
        .controls h3 {
            color: #ff6b35;
            margin-bottom: 1rem;
            text-align: center;
            font-size: 1.2rem;
        }
        .control-group {
            margin-bottom: 1rem;
            padding-bottom: 0.5rem;
            border-bottom: 1px solid rgba(255,255,255,0.1);
        }
        .control-group:last-child { border-bottom: none; margin-bottom: 0; }
        .control-group label {
            display: block;
            color: #ff6b35;
            font-weight: bold;
            margin-bottom: 0.5rem;
            font-size: 0.9rem;
        }
        .value-display {
            color: #ff6b35;
            font-weight: bold;
            background: rgba(255, 107, 53, 0.1);
            padding: 0.2rem 0.6rem;
            border-radius: 12px;
            min-width: 40px;
            text-align: center;
        }
        .control-group input[type="range"] {
            width: 100%;
            height: 8px;
            border-radius: 4px;
            background: rgba(255, 255, 255, 0.2);
            outline: none;
            -webkit-appearance: none;
            margin-bottom: 0.5rem;
        }
        .control-group input[type="range"]::-webkit-slider-thumb {
            -webkit-appearance: none;
            width: 20px;
            height: 20px;
            border-radius: 50%;
            background: linear-gradient(45deg, #ff6b35, #f7931e);
            cursor: pointer;
            box-shadow: 0 2px 8px rgba(255, 107, 53, 0.4);
            border: 2px solid white;
        }
        .control-group button {
            width: 100%;
            background: linear-gradient(45deg, #ff6b35, #f7931e);
            color: white;
            border: none;
            padding: 0.5rem;
            border-radius: 5px;
            cursor: pointer;
            font-weight: bold;
            margin-bottom: 0.5rem;
            transition: all 0.3s ease;
            font-size: 0.9rem;
        }
        .control-group button:hover {
            background: linear-gradient(45deg, #f7931e, #ff6b35);
            transform: translateY(-2px);
        }
        .interaction-hint {
            position: fixed;
            bottom: 20px;
            left: 20px;
            background: rgba(0,0,0,0.8);
            padding: 0.5rem 1rem;
            border-radius: 15px;
            backdrop-filter: blur(10px);
            border: 1px solid rgba(255, 107, 53, 0.3);
            z-index: 100;
            font-size: 0.9rem;
            color: rgba(255, 255, 255, 0.9);
            opacity: 0.8;
        }
        @media (max-width: 768px) {
            .controls {
                position: fixed;
                bottom: 100px;
                left: 20px;
                right: 20px;
                top: auto;
                max-height: 50vh;
                overflow-y: auto;
            }
        }
    </style>
</head>
<body>
    <div class="controls">
        <h3>üå∫ Pookalam Designer</h3>
        <div class="control-group">
            <label>Petals: <span id="petals-value">4</span></label>
            <input type="range" id="petals" min="2" max="12" value="4">
        </div>
        <div class="control-group">
            <label>Layers: <span id="layers-value">8</span></label>
            <input type="range" id="layers" min="4" max="15" value="8">
        </div>
        <div class="control-group">
            <label>Color: <span id="color-value">45</span></label>
            <input type="range" id="color" min="0" max="360" value="45">
        </div>
        <div class="control-group">
            <label>Size: <span id="size-value">4000</span></label>
            <input type="range" id="size" min="2000" max="8000" value="4000">
        </div>
        <div class="control-group">
            <button onclick="generateNew()">New Pookalam</button>
        </div>
        <div class="control-group">
            <button onclick="saveImage()">Save Image</button>
        </div>
    </div>

    <div class="info">
        <p><span class="onam-emoji">ÔøΩ</span> Happy Onam! Drag to rotate your pookalam <span class="onam-emoji">üå∫</span></p>
    </div>

    <script src="https://cdnjs.cloudflare.com/ajax/libs/three.js/r128/three.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/three@0.128.0/examples/js/controls/OrbitControls.js"></script>
    
    <script>
        let scene, camera, renderer, controls;
        let petals = [], group;
        let settings = {
            petalCount: 4,
            layers: 8,
            color: 45,
            size: 4000
        };

        function init() {
            // Scene with gradient background
            scene = new THREE.Scene();
            scene.background = new THREE.Color(0x0a0a1a);

            // Camera
            camera = new THREE.PerspectiveCamera(75, window.innerWidth / window.innerHeight, 0.1, 1000);
            camera.position.z = 6;

            // Renderer with enhanced settings
            renderer = new THREE.WebGLRenderer({ 
                antialias: true,
                alpha: true,
                powerPreference: "high-performance"
            });
            renderer.setSize(window.innerWidth, window.innerHeight);
            renderer.setPixelRatio(Math.min(window.devicePixelRatio, 2));
            renderer.shadowMap.enabled = true;
            renderer.shadowMap.type = THREE.PCFSoftShadowMap;
            document.body.appendChild(renderer.domElement);

            // Enhanced Controls
            controls = new THREE.OrbitControls(camera, renderer.domElement);
            controls.enableDamping = true;
            controls.dampingFactor = 0.05;
            controls.autoRotate = true;
            controls.autoRotateSpeed = 0.5;
            controls.enableZoom = true;
            controls.minDistance = 3;
            controls.maxDistance = 15;

            // Lighting
            const ambientLight = new THREE.AmbientLight(0x404040, 0.4);
            scene.add(ambientLight);
            
            const directionalLight = new THREE.DirectionalLight(0xffffff, 0.8);
            directionalLight.position.set(10, 10, 5);
            directionalLight.castShadow = true;
            scene.add(directionalLight);

            // Main group
            group = new THREE.Group();
            scene.add(group);

            // Setup controls
            setupControls();
            
            // Generate initial pookalam
            generatePookalam();
            
            // Start animation
            animate();
            
            // Welcome message
            console.log('üå∏ Welcome to Code-a-Pookalam! üå∏');
            console.log('üé® Create beautiful digital floral carpets for Onam!');
        }

        function setupControls() {
            const inputs = ['petals', 'layers', 'color', 'size'];
            inputs.forEach(id => {
                const input = document.getElementById(id);
                const valueDisplay = document.getElementById(id + '-value');
                
                input.addEventListener('input', () => {
                    valueDisplay.textContent = input.value;
                    settings[id === 'petals' ? 'petalCount' : id] = parseInt(input.value);
                    generatePookalam();
                });
            });
        }

        function generatePookalam() {
            // Clear existing petals
            while(group.children.length > 0) {
                group.remove(group.children[0]);
            }

            const { petalCount, layers, color, size } = settings;

            // Create multiple rings of petals
            for(let layer = 0; layer < layers; layer++) {
                for(let petal = 0; petal < petalCount; petal++) {
                    createPetal(layer, petal, layers, petalCount, color, size);
                }
            }
            
            // Add center decoration
            createCenter(color);
        }

        function createPetal(layer, petal, totalLayers, totalPetals, baseColor, size) {
            const points = [];
            const numPoints = Math.floor(size / 100);
            
            // Create more organic petal shape
            for(let i = 0; i < numPoints; i++) {
                const t = i / numPoints;
                const angle = t * Math.PI * 1.5; // 3/4 circle for petal shape
                const radius = Math.sin(t * Math.PI) * (0.4 + layer * 0.25) * (1 + Math.sin(t * Math.PI * 3) * 0.1);
                
                const x = Math.cos(angle) * radius;
                const y = Math.sin(angle) * radius;
                const z = (Math.sin(t * Math.PI * 2) * 0.15) + (layer * 0.08);
                
                points.push(new THREE.Vector3(x, y, z));
            }

            // Create geometry
            const geometry = new THREE.BufferGeometry().setFromPoints(points);
            
            // Create material with enhanced colors
            const hue = (baseColor + (layer * 25) + (petal * 15)) % 360;
            const saturation = 70 + (layer * 5);
            const lightness = 50 + (layer * 3);
            
            const material = new THREE.LineBasicMaterial({
                color: new THREE.Color(`hsl(${hue}, ${saturation}%, ${lightness}%)`),
                transparent: true,
                opacity: 0.8 - (layer * 0.05),
                linewidth: 3
            });

            // Create line
            const line = new THREE.Line(geometry, material);
            
            // Position and rotate
            const rotationOffset = (petal / totalPetals) * Math.PI * 2;
            line.rotation.z = rotationOffset;
            line.rotation.x = Math.sin(layer * 0.5) * 0.2;
            line.rotation.y = Math.cos(layer * 0.3) * 0.1;
            
            const scale = 0.6 + (layer * 0.15);
            line.scale.setScalar(scale);
            
            group.add(line);
        }

        function createCenter(baseColor) {
            // Create center sphere
            const geometry = new THREE.SphereGeometry(0.15, 16, 12);
            const material = new THREE.MeshPhongMaterial({
                color: new THREE.Color(`hsl(${(baseColor + 180) % 360}, 80%, 60%)`),
                shininess: 100,
                transparent: true,
                opacity: 0.9
            });
            
            const sphere = new THREE.Mesh(geometry, material);
            sphere.castShadow = true;
            sphere.receiveShadow = true;
            group.add(sphere);
        }

        function generateNew() {
            // Generate random but pleasing combinations
            settings.petalCount = Math.floor(Math.random() * 8) + 3;
            settings.layers = Math.floor(Math.random() * 10) + 5;
            settings.color = Math.floor(Math.random() * 360);
            settings.size = Math.floor(Math.random() * 4000) + 3000;
            
            updateControlsDisplay();
            generatePookalam();
            
            console.log('üé≤ New random pookalam generated! üé®');
        }

        function updateControlsDisplay() {
            Object.keys(settings).forEach(key => {
                const input = document.getElementById(key === 'petalCount' ? 'petals' : key);
                const display = document.getElementById((key === 'petalCount' ? 'petals' : key) + '-value');
                if (input && display) {
                    input.value = settings[key];
                    display.textContent = settings[key];
                }
            });
        }

        function saveImage() {
            // Render the scene
            renderer.render(scene, camera);
            
            // Create download link
            const link = document.createElement('a');
            link.download = `pookalam-onam-${Date.now()}.png`;
            link.href = renderer.domElement.toDataURL('image/png');
            link.click();
            
            console.log('üíæ Pookalam image saved! üå∏');
        }

        function animate() {
            requestAnimationFrame(animate);
            
            // Enhanced rotation with organic movement
            group.rotation.z += 0.003;
            group.rotation.x = Math.sin(Date.now() * 0.001) * 0.1;
            group.rotation.y = Math.cos(Date.now() * 0.0008) * 0.08;
            
            controls.update();
            renderer.render(scene, camera);
        }

        // Handle window resize
        window.addEventListener('resize', () => {
            camera.aspect = window.innerWidth / window.innerHeight;
            camera.updateProjectionMatrix();
            renderer.setSize(window.innerWidth, window.innerHeight);
        });

        // Initialize when page loads
        window.addEventListener('load', init);
        
        // Add some keyboard shortcuts
        window.addEventListener('keydown', (event) => {
            switch(event.key) {
                case 'r':
                case 'R':
                    generateNew();
                    break;
                case 's':
                case 'S':
                    if (event.ctrlKey) {
                        event.preventDefault();
                        saveImage();
                    }
                    break;
            }
        });
    </script>
    </script>
</body>
</html>
